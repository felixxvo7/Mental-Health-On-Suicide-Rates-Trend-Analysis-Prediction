library(tidyverse)
library(lubridate)
library(plotly)
library(data.table)
library(ggplot2)
library(dplyr)
mental_health <- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/raw/mental health CAN 02-22.csv") %>%
mutate(Year = (REF_DATE))
# Clean and prepare data
processed_data <- mental_health %>%
# Filter key indicators and remove confidence intervals
filter(Indicators %in% c("Major depressive episode, life", "Cannabis use, life"),
Characteristics == "Percent",
Gender != "Total, gender of person") %>%
# Convert year and values to numeric
mutate(Year = as.numeric(REF_DATE),
Value = as.numeric(VALUE)) %>%
# Handle missing data
filter(!is.na(Value)) %>%
# Select relevant columns
select(Year, Age_group = `Age group`, Gender, Indicators, Value)
library(tidyverse)
library(lubridate)
library(plotly)
library(data.table)
library(ggplot2)
library(dplyr)
mental_health <- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/raw/mental health CAN 02-22.csv") %>%
mutate(Year = (REF_DATE))
# Clean and prepare data
processed_data <- mental_health %>%
# Filter key indicators and remove confidence intervals
filter(Indicators %in% c("Major depressive episode, life", "Cannabis use, life"),
Characteristics == "Percent",
Gender != "Total, gender of person") %>%
# Convert year and values to numeric
mutate(Year = as.numeric(REF_DATE),
Value = as.numeric(VALUE)) %>%
# Handle missing data
filter(!is.na(Value)) %>%
# Select relevant columns
select(Year, Age.group = `Age.group`, Gender, Indicators, Value)
# Create visualization
ggplot(processed_data, aes(x = Year, y = Value, color = Gender)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
facet_grid(Indicators ~ Age.group, scales = "free_y") +
labs(title = "Mental Health Trends in Canada (2002-2022)",
subtitle = "Percentage of Population by Age Group and Gender",
y = "Percentage (%)",
x = "Year",
color = "Gender") +
scale_x_continuous(breaks = seq(2002, 2022, 5)) +
scale_color_manual(values = c("Men+" = "#1f77b4", "Women+" = "#ff7f0e")) +
theme_minimal() +
theme(legend.position = "bottom",
strip.text = element_text(size = 10, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1))
library(tidyverse)
mental_health <- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/raw/mental health CAN 02-22.csv"
# Convert suppressed values (E/F) to NA
mental_health <- mental_health %>%
mental_health <- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/raw/mental health CAN 02-22.csv")
# Convert suppressed values (E/F) to NA
mental_health <- mental_health %>%
mutate(VALUE = ifelse(VALUE %in% c("E", "F"), NA, VALUE))
# Handle missing values
mental_health <- mental_health %>%
filter(!is.na(VALUE) & VALUE != "")
sum(is.na(mental_health))
mental_health <- mental_health %>%
rename(
Year = REF_DATE,
Geography = GEO,
Age_Group = `Age group`,
Unit = UOM
) %>%
mutate(
Year = as.numeric(Year),
Value = as.numeric(VALUE)
)
mental_health <- mental_health %>%
rename(
Year = REF_DATE,
Geography = GEO,
Age.Group = `Age group`,
Unit = UOM
) %>%
mutate(
Year = as.numeric(Year),
Value = as.numeric(VALUE)
)
mental_health <- mental_health %>%
rename(
Year = REF_DATE,
Geography = GEO,
Age_Group = `Age.group`,
Unit = UOM
) %>%
mutate(
Year = as.numeric(Year),
Value = as.numeric(VALUE)
)
mental_health <- mental_health %>%
mutate(
Age_Group = case_when(
Age_Group == "Total, 15 years and over" ~ "15+ Years",
Age_Group == "15 to 24 years" ~ "15-24 Years",
Age_Group == "25 to 64 years" ~ "25-64 Years",
TRUE ~ Age_Group
)
)
# Separate main values from confidence intervals
main_data <- mental_health %>%
filter(!str_detect(Characteristics, "confidence interval"))
ci_data <- mental_health %>%
filter(str_detect(Characteristics, "confidence interval")) %>%
mutate(CI_Type = ifelse(
str_detect(Characteristics, "Low"), "Low_CI", "High_CI")) %>%
select(-Characteristics) %>%
pivot_wider(names_from = CI_Type, values_from = Value)
final_data <- main_data %>%
left_join(ci_data, by = c("Year", "Geography", "Age_Group", "Gender", "Indicators"))
View(final_data)
View(ci_data)
View(processed_data)
View(final_data)
final_data <- main_data %>%
left_join(ci_data, by = c("Year", "Geography", "Age_Group", "Gender", "Indicators"))
final_data <- final_data %>%
select(
Year, Geography, Age_Group, Gender,
Indicators, Value, Low_CI, High_CI
) %>%
filter(Year >= 2002 & Year <= 2022)
View(final_data)
library(tidyverse)
mental_health <- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/raw/mental health CAN 02-22.csv")
# Convert suppressed values (E/F) to NA
mental_health <- mental_health %>%
mutate(VALUE = ifelse(VALUE %in% c("E", "F"), NA, VALUE))
# Handle missing values
mental_health <- mental_health %>%
filter(!is.na(VALUE) & VALUE != "")
mental_health <- mental_health %>%
rename(
Year = REF_DATE,
Geography = GEO,
Age_Group = `Age.group`,
Unit = UOM
) %>%
mutate(
Year = as.numeric(Year),
Value = as.numeric(VALUE)
)
mental_health <- mental_health %>%
mutate(
Age_Group = case_when(
Age_Group == "Total, 15 years and over" ~ "15+ Years",
Age_Group == "15 to 24 years" ~ "15-24 Years",
Age_Group == "25 to 64 years" ~ "25-64 Years",
TRUE ~ Age_Group
)
)
library(tidyverse)
mental_health <- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/raw/mental health CAN 02-22.csv")
# Convert suppressed values (E/F) to NA
mental_health <- mental_health %>%
mutate(VALUE = ifelse(VALUE %in% c("E", "F"), NA, VALUE))
# Handle missing values
mental_health <- mental_health %>%
filter(!is.na(VALUE) & VALUE != "")
mental_health <- mental_health %>%
rename(
Year = REF_DATE,
Geography = GEO,
Age_Group = `Age.group`,
Unit = UOM
) %>%
mutate(
Year = as.numeric(Year),
Value = as.numeric(VALUE)
)
mental_health <- mental_health %>%
mutate(
Age_Group = case_when(
Age_Group == "Total, 15 years and over" ~ "15+ Years",
Age_Group == "15 to 24 years" ~ "15-24 Years",
Age_Group == "25 to 64 years" ~ "25-64 Years",
TRUE ~ Age_Group
)
)
library(tidyverse)
mental_health <- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/raw/mental health CAN 02-22.csv")
# Convert suppressed values (E/F) to NA
mental_health <- mental_health %>%
mutate(VALUE = ifelse(VALUE %in% c("E", "F"), NA, VALUE))
# Handle missing values
mental_health <- mental_health %>%
filter(!is.na(VALUE) & VALUE != "")
mental_health <- mental_health %>%
rename(
Year = REF_DATE,
Geography = GEO,
Age_Group = `Age.group`,
Unit = UOM
) %>%
mutate(
Year = as.numeric(Year),
Value = as.numeric(VALUE)
)
mental_health <- mental_health %>%
mutate(
Age_Group = case_when(
Age_Group == "Total, 15 years and over" ~ "15+ Years",
Age_Group == "15 to 24 years" ~ "15-24 Years",
Age_Group == "25 to 64 years" ~ "25-64 Years",
TRUE ~ Age_Group
)
)
View(mental_health)
mental_health <- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/raw/mental health CAN 02-22.csv")
# Handle missing values
mental_health <- mental_health %>%
filter(!is.na(VALUE) & VALUE != "")
mental_health <- mental_health %>%
rename(
Year = REF_DATE,
Geography = GEO,
Age_Group = `Age.group`,
Unit = UOM
) %>%
mutate(
Year = as.numeric(Year),
Value = as.numeric(VALUE)
)
mental_health <- mental_health %>%
mutate(
Age_Group = case_when(
Age_Group == "Total, 15 years and over" ~ "15+ Years",
Age_Group == "15 to 24 years" ~ "15-24 Years",
Age_Group == "25 to 64 years" ~ "25-64 Years",
TRUE ~ Age_Group
)
)
# Separate main values from confidence intervals
main_data <- mental_health %>%
filter(!str_detect(Characteristics, "confidence interval"))
ci_data <- mental_health %>%
filter(str_detect(Characteristics, "confidence interval")) %>%
mutate(CI_Type = ifelse(
str_detect(Characteristics, "Low"), "Low_CI", "High_CI")) %>%
select(-Characteristics) %>%
pivot_wider(names_from = CI_Type, values_from = Value)
final_data <- main_data %>%
left_join(ci_data, by = c("Year", "Geography", "Age_Group", "Gender", "Indicators"))
final_data <- final_data %>%
select(
Year, Geography, Age_Group, Gender,
Indicators, Value, Low_CI, High_CI
) %>%
filter(Year >= 2002 & Year <= 2022)
View(ci_data)
View(final_data)
View(final_data)
View(ci_data)
main_data <- main_data %>%
mutate(row_id = row_number())
ci_data <- ci_data %>%
mutate(row_id = row_number())
final_data <- main_data %>%
left_join(ci_data, by = c("Year", "Geography", "Age_Group", "Gender", "Indicators", "row_id")) %>%
select(-row_id)
View(final_data)
ggplot(final_data, aes(x = year, y = value, color = gender)) +
geom_ribbon(aes(ymin = low_ci, ymax = high_ci, fill = gender), alpha = 0.1) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
facet_grid(indicators ~ age_group, scales = "free_y") +
labs(title = "Mental Health Trends in Canada (2002-2022)",
subtitle = "With 95% Confidence Intervals",
y = "Percentage (%)",
x = "Year") +
scale_x_continuous(breaks = seq(2000, 2022, 5)) +
scale_color_manual(values = c("Men+" = "#1f77b4", "Women+" = "#ff7f0e")) +
scale_fill_manual(values = c("Men+" = "#1f77b4", "Women+" = "#ff7f0e")) +
theme_minimal() +
theme(legend.position = "bottom",
strip.text = element_text(face = "bold"))
library(tidyverse)
mental_health <- read.csv("C:/Users/felix/Desktop/CODING/felix's works/Mental-Health-On-Suicide-Rates-Trend-Analysis-Prediction/datasets/raw/mental health CAN 02-22.csv")
# Handle missing values
mental_health <- mental_health %>%
filter(!is.na(VALUE) & VALUE != "")
mental_health <- mental_health %>%
rename(
Year = REF_DATE,
Geography = GEO,
Age_Group = `Age.group`,
Unit = UOM
) %>%
mutate(
Year = as.numeric(Year),
Value = as.numeric(VALUE)
)
mental_health <- mental_health %>%
mutate(
Age_Group = case_when(
Age_Group == "Total, 15 years and over" ~ "15+ Years",
Age_Group == "15 to 24 years" ~ "15-24 Years",
Age_Group == "25 to 64 years" ~ "25-64 Years",
TRUE ~ Age_Group
)
)
# Separate main values from confidence intervals
main_data <- mental_health %>%
filter(!str_detect(Characteristics, "confidence interval"))
ci_data <- mental_health %>%
filter(str_detect(Characteristics, "confidence interval")) %>%
mutate(CI_Type = ifelse(
str_detect(Characteristics, "Low"), "Low_CI", "High_CI")) %>%
select(-Characteristics) %>%
pivot_wider(names_from = CI_Type, values_from = Value)
main_data <- main_data %>%
mutate(row_id = row_number())
ci_data <- ci_data %>%
mutate(row_id = row_number())
final_data <- main_data %>%
left_join(ci_data, by = c("Year", "Geography", "Age_Group", "Gender", "Indicators", "row_id")) %>%
select(-row_id)
ggplot(final_data, aes(x = year, y = value, color = gender)) +
geom_ribbon(aes(ymin = low_ci, ymax = high_ci, fill = gender), alpha = 0.1) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
facet_grid(indicators ~ age_group, scales = "free_y") +
labs(title = "Mental Health Trends in Canada (2002-2022)",
subtitle = "With 95% Confidence Intervals",
y = "Percentage (%)",
x = "Year") +
scale_x_continuous(breaks = seq(2000, 2022, 5)) +
scale_color_manual(values = c("Men+" = "#1f77b4", "Women+" = "#ff7f0e")) +
scale_fill_manual(values = c("Men+" = "#1f77b4", "Women+" = "#ff7f0e")) +
theme_minimal() +
theme(legend.position = "bottom",
strip.text = element_text(face = "bold"))
# 1. Check column names after preprocessing
names(final_data)
# 2. Verify indicators column exists - if not, fix upstream:
final_data <- final_data %>%
rename(indicators = Indicators) # Adjust capitalization if needed
# 3. Modified visualization code
ggplot(final_data, aes(x = year, y = value, color = gender)) +
geom_ribbon(aes(ymin = low_ci, ymax = high_ci, fill = gender), alpha = 0.1) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
facet_grid(indicators ~ age_group, scales = "free_y") + # Ensure match
labs(title = "Mental Health Trends in Canada (2002-2022)",
subtitle = "With 95% Confidence Intervals",
y = "Percentage (%)",
x = "Year") +
scale_x_continuous(breaks = seq(2000, 2022, 5)) +
theme_minimal()
# 1. Check column names after preprocessing
names(final_data)
# 2. Verify indicators column exists - if not, fix upstream:
final_data <- final_data %>%
rename(indicators = Indicators) # Adjust capitalization if needed
# 3. Modified visualization code
ggplot(final_data, aes(x = year, y = value, color = gender)) +
geom_ribbon(aes(ymin = low_ci, ymax = high_ci, fill = gender), alpha = 0.1) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
facet_grid(indicators ~ Age_Group, scales = "free_y") + # Ensure match
labs(title = "Mental Health Trends in Canada (2002-2022)",
subtitle = "With 95% Confidence Intervals",
y = "Percentage (%)",
x = "Year") +
scale_x_continuous(breaks = seq(2000, 2022, 5)) +
theme_minimal()
